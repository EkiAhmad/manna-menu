<template>
  <div class="admin_categories-list">
    <q-table
      title="Stores"
      :data="result"
      :columns="dt.cols"
      row-key="index"
      :loading="dt.loading"
      :filter="dt.filter"
      :visible-columns="dt.cols_visible"
      :pagination.sync="pagination"
    >
        <template slot="top-right" slot-scope="props">
          <q-search color="secondary" v-model="dt.filter" placeholder="Search..."/>
        </template>
        <div slot="top-left" slot-scope="props">
          <q-btn round color="secondary" icon="refresh" @click="getData">
            <q-tooltip anchor="center right" self="center left" :offset="[10, 10]">Refresh</q-tooltip>
          </q-btn>
        </div>
        <q-td slot="body-cell-product" slot-scope="props" :props="props" class="vertical-top">
          <p class="text-faded q-mb-xs">{{props.row.category}}</p>
          <strong>{{props.value}}</strong>
        </q-td>
    </q-table>
  </div>
</template>

<script>
import { size } from 'lodash'

const role = 'admin'
const resource = 'sales'
const baseRoute = `/${role}/${resource}`

export default {
  async mounted () {
    this.dt.loading=true
    await this.getData()
  },
  data () {
    return {
      baseRoute,
      resource,
      pagination: {
        sortBy: null, // String, column "name" property value
        rowsPerPage: 20 // current rows per page being displayed
      },
      result: [],
      dt: {
        loading:true,
        filter: '',
        cols_visible: ['trx_date', 'trx', 'store', 'sku', 'product', 'qty', 'amount'],
        cols: [
          {
            name: 'trx_date',
            label: 'Trx Date',
            align: 'left',
            field: 'trx_date',
            sortable: true
          },
          {
            name: 'trx',
            label: 'Trx ID',
            align: 'left',
            field: 'trx',
            sortable: true,
          },
          {
            name: 'store',
            label: 'Store',
            align: 'left',
            field: 'store',
            sortable: true
          },
          {
            name: 'sku',
            label: 'SKU',
            align: 'center',
            field: 'product_sku',
            sortable: true
          },
          {
            name: 'product',
            label: 'Product',
            align: 'left',
            field: 'product',
            sortable: false
          },
          {
            name: 'qty',
            label: 'Qty',
            align: 'right',
            field: 'quantity',
            sortable: true,
          },
          {
            name: 'amount',
            label: 'Amount',
            align: 'right',
            field: 'price_sales',
            field: row => {
              let money = '0';
              if (row.price_sales) {
                const reverse = row.price_sales
                  .toString()
                  .split("")
                  .reverse()
                  .join("");
                money = reverse.match(/\d{1,3}/g);
                money = money
                  .join(".")
                  .split("")
                  .reverse()
                  .join("");
              }
              return 'Rp ' + money;
            },
            sortable: true
          },
        ],
      },
    }
  },
  methods: {
    async getData() {
      try {
        const {data} = await this.$axios.get(`/${resource}/products`)
        this.dt.loading=false
        this.result = data.sales_product
      } catch(e) {
        this.dt.loading=false
        if (e.response) {
          await this.alert("error", e.response.data)
        } else {
          await this.alert("error", "No Internet Connection")
        }
      }
    },
    alert(type, msg) {
      this.$q.notify({
        message: msg,
        position: 'top',
        type: type==='success'?'positive':'negative',
        timeout: 1500
      })
    }
  }
}
</script>

<style scoped>
.q-table-container >>> .q-table tr {
  height: 45px !important;
}
</style>
